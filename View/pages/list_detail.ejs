<%- include('../partials/head')%>
<body class="min-h-screen font-regular relative overflow-x-hidden">
    <%- include('../partials/fixed_video_bg') %>
    <!-- navbar -->
    <%- include('../partials/navbar')%>
    <!-- header -->
    <header class="min-h-screen flex flex-col items-center justify-center relative">
        <div class="list-detail__appear transform scale-0 transition-all list-detail__appear--2 flex flex-col items-center justify-center text-gray-500 text-sm">
            <strong class="capitalize font-title">
                created on
            </strong>
            <div class="my-1 flex justify-center items-center">
                <span><%= data.date.date %></span><sup><%= data.date.suffix %></sup><span class="capitalize">&nbsp; <%= data.date.month %></span><span>&nbsp;&comma; <%= data.date.year %></span>
            </div>
        </div>
        <h1 class="list-detail__appear transform scale-0 transition-all list-detail__appear--1 text-8xl font-title capitalize text-center w-min mx-auto bg-gradient-to-r from-pink-600 to-purple-700 text-transparent bg-clip-text font-bold">
            <%= data[0].list_title %>
        </h1>
        <div class="flex items-center justify-center list-detail__appear transform scale-0 transition-all list-detail__appear--3 my-2 mx-auto w-max ">
            <strong class="text-sm mr-2 capitalize text-gray-500">
                created by
            </strong>
            <a href="/reviewers/<%= data.uid %>" class="block text-center capitalize text-gray-500 hover:text-pink-600 border-b-2 border-transparent hover:border-current hover:shadow-xl">
                <%= data[0].user_name %>
            </a>
        </div>
        <p class="list-detail__appear transform scale-0 transition-all list-detail__appear--4 text-gray-600 text-lg leading-relaxed w-5/6 md:w-3/5 md:text-xl mx-auto text-center">
            <% if (data[0].list_desc) { %>
                <%= data[0].list_desc %>
            <% } else { %>
                <span class="text-gray-400">
                    No description available
                </span>
            <% } %>
        </p>
        <% if(authorized) { %>
            <div class="flex items-center my-6 list-detail__appear list-detail__appear--5 transition-all transform scale-0">
                <a href="/moovey/list/<%= data.lid %>/edit" title="Edit" class="text-xl transform transition-all hover:scale-125 text-pink-600 far fa-edit m-2 outline-none focus:outline-none"></a>
                <button id="openDeleteModal" title="Delete" class="text-xl transform transition-all hover:scale-125 text-pink-600 far fa-times-circle m-2 outline-none focus:outline-none"></button>
            </div>
        <% } %>
        <div id="readList" class="flex flex-col items-center justify-center list-detail__appear transform scale-0 transition-all list-detail__appear--6 my-4 mx-auto w-max text-gray-400 hover:text-gray-700 relative">
            <button class="far fa-arrow-alt-circle-down mt-3 animate-bounce text-3xl block outline-none focus:outline-none"></button>
        </div>
    </header>

    <% if (data.length > 0) {%>
    <ul class="z-10 flex items-center justify-center my-4 w-full">
        <li class="sectionSelector cursor-pointer px-3 text-pink-600 font-bold uppercase flex items-center">
            <i class="fas fa-stream"></i>
            <span class="ml-1 hidden md:block">
                List |
            </span>
        </li>
        <li title="testimonials" class="sectionSelector cursor-pointer hover:text-gray-700 px-3 text-gray-500 uppercase flex items-center">
            <i class="far fa-comments"></i>
            <span class="ml-1 hidden md:block">
                testimonials
            </span>
        </li>
    </ul>
    <main id="listBody" class="min-h-screen h-full w-full bg-gradient-to-r to-pink-700 from-purple-700">
        <% data.forEach((datum, index) => { %>
            <%- include('../partials/list_item', { item: datum, index: index }) %>
        <% }) %>        
    </main>
    <% } %>
  <!-- only auth -->
  <% if(authorized) { %>
    <% if(showSearchForm) { %>
        <section class="fixed top-0 left-0 h-screen w-screen bg-black bg-opacity-90 flex items-center justify-center transform transition-all scale-100 z-40">
            <article class="bg-gray-200 h-4/5 w-4/5 max-w-3xl rounded-md shadow-2xl flex items-center justify-start flex-col relative p-2">
                <a href="/moovey/list/<%= data.lid %>" class="fas fa-times text-lg absolute top-4 right-4"></a>
                <section class="w-full bg-gray-200 p-2 max-w-lg mx-auto">
                    <span class="text-2xl block break-words text-center text-gray-700 my-2">
                        Search moovey to list    
                    </span>
                    <form action="/moovey/list/<%= data.lid %>/search" method="POST" class="w-full" autocomplete="off">
                        <label for="searchKey" class="m-1 text-gray-600 capitalize">
                            movie title
                        </label>
                        <section class="relative w-full">
                            <input 
                                type="text" 
                                name="searchKey"
                                id="searchKey"
                                required
                                placeholder="Eg. There will be blood"
                                class="p-2.5 pr-8 text-sm w-full block rounded-md shadow-md outline-none focus:outline-none focus:shadow-2xl focus:scale-x-105 transform transition-all duration-200 focus:text-gray-600 focus:placeholder-gray-600">
                            <button type="submit" class="text-gray-700 z-10 absolute right-2 top-1/2 transform 
                            -translate-y-1/2 outline-none focus:outline-none focus:scale-125 hover:scale-125">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                            </button>
                        </section>
                    </form>
                </section>
            </article>
        </section>
    <% } %>

    <% if(movies.length > 0) { %>
        <section class="fixed top-0 left-0 h-screen w-screen bg-black bg-opacity-90 flex items-center justify-center transform transition-all scale-100 z-40">
            <article class="bg-gray-200 h-4/5 w-4/5 max-w-3xl rounded-md shadow-2xl flex items-center justify-start flex-col relative p-2">
                <a href="/moovey/list/<%= data.lid %>" class="fas fa-times text-lg absolute top-4 right-6"></a>
                <section class="w-full bg-gray-200 p-2 max-w-lg mx-auto">
                    <p class="text-center text-gray-600 break-words">
                        <span>Search result for &ndash;</span>
                        <span class="text-pink-600">
                            &ldquo;<%= searchFor %>&rdquo;
                        </span>
                    </p>
                </section>
                <section class="styledScrollbar py-4 overflow-y-auto w-full grid grid-cols-1 md:grid-cols-2 bg-gray-200">
                    <% if (movies) { %>
                        <% movies.forEach(movie => { %>
                            <form
                                class="w-full mx-auto flex items-center justify-center outline-none focus:outline-none" 
                                method="GET" 
                                action="/moovey/list/<%= data.lid %>/add/<%= movie.imdbid %>">
                                <button type="submit" class="outline-none focus:outline-none">
                                    <%- include('../partials/movie_thumbnail', {movie: movie}) %>
                                </button>
                            </form>
                        <% }) %>
                    <% } %>
                </section>
            </article>
        </section>
    <% } %>

    <% if(showAddModal > 0) { %>
        <section class="fixed top-0 left-0 h-screen w-screen bg-black bg-opacity-90 flex items-center justify-center transform transition-all scale-100 z-40">
            <article class="bg-gray-200 h-4/5 w-4/5 max-w-3xl rounded-md shadow-2xl flex items-center justify-start flex-col relative p-2">
                <a href="/moovey/list/<%= data.lid %>" class="fas fa-times text-lg absolute top-4 right-4"></a>
                <section class="w-full bg-gray-200 p-2 max-w-lg mx-auto">
                    <span class="text-2xl block break-words text-center text-gray-700 my-2">
                        Add moovey to list    
                    </span>
                </section>
                <section class="styledScrollbar py-4 overflow-y-auto w-full flex flex-col items-center justify-center bg-gray-200 md:grid md:grid-cols-3 md:gap-4">
                    <strong class="text-lg text-gray-600 font-title text-center">
                        <%= movies[0].title %> (<%= movies[0].year %>)
                    </strong>
                    <img
                        class="h-44 w-auto block mx-auto my-4 object-cover shadow-2xl" 
                        src="<% if (movies[0].poster === 'N/A') { %>/static/assets/placeholder.jpg<% } else { %><%= movies[0].poster %><% } %>" alt="<%= movies[0].title %> poster courtesy OMDB API">
                    <form
                        class="w-5/6 mx-auto flex flex-col items-center justify-center" 
                        method="POST" 
                        action="/moovey/list/<%= data.lid %>/add/<%= movies[0].imdbid %>">
                        <label for="itemDescription" class="m-1 text-gray-600 capitalize">
                            Add description (optional)
                        </label>
                        <section class="relative w-full">
                            <textarea 
                                type="text" 
                                name="itemDescription"
                                id="itemDescription"
                                required
                                maxlength="250"
                                placeholder="A brief description of the moovey you are adding"
                                class="resize-none p-2.5 text-sm w-full block rounded-md shadow-md outline-none focus:outline-none focus:shadow-2xl focus:scale-x-105 transform transition-all duration-200 focus:text-gray-600 focus:placeholder-gray-600 h-36 overflow-y-auto"></textarea>
                        </section>
                        <input type="hidden" name="imdbid" value="<%= movies[0].imdbid %>">
                        <button type="submit" class=" my-4 text-gray-200 bg-black py-1 px-5 hover:text-white hover:scale-105 hover:-translate-y-px transform transition-all">
                            <i class="far fa-plus-square"></i>
                            <span class="ml-1 uppercase text-sm">
                                add
                            </span>
                        </button>
                    </form>
                </section>
            </article>
        </section>
    <% } %>
    <!-- delete modal only if authorized -->
    <section id="deleteConfirmModal" class="flex items-center justify-center transition-all transform fixed z-50 top-0 left-0 h-screen w-full bg-black bg-opacity-90 scale-0">
        <article class="bg-white h-52 w-4/5 max-w-lg rounded-sm shadow-2xl flex items-start justify-center flex-col p-6">
            <strong class="text-lg break-words text-gray-500">
                Are you sure you want to delete list <span class="text-pink-700">"<%= data.title %>"</span>?
            </strong>
            <small class="text-xs text-gray-400 block text-left capitalize mt-1">
                once deleted, the change cannot be undone.
            </small>
            <div class="flex items-center justify-center my-4">
                <form action="/moovey/list/<%= data.lid %>/delete">
                    <button type="submit" class="m-1.5 p-2 text-sm rounded-sm transform transition-all hover:scale-105 hover:shadow-lg text-white bg-pink-600 outline-none focus:outline-none">
                        <i class="fas fa-check"></i>
                        <span class="ml-1">Go ahead and delete it</span>
                    </button>
                    <button id="closeDeleteModal" type="button" class="m-1.5 p-2 text-sm rounded-sm transform transition-all hover:scale-105 hover:shadow-lg text-white bg-black outline-none focus:outline-none">
                        <i class="fas fa-times"></i>
                        <span class="ml-1">
                            Take me back
                        </span>
                    </button>
                </form>
            </div>
        </article>
    </section>
    <% } %>

    <!-- footer -->

    <%- include('../partials/footer') %>

    <script src="/static/js/index.js"></script>
    <script src="/static/js/navScroll.js"></script>
    <script src="/static/js/listDetail.js"></script>
</body>
</html>


